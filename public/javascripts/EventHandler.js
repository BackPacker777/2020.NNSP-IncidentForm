"use strict";import SetSessionStorage from"./SetSessionStorage.js";import FadeStuff from"./FadeStuff.js";export default class EventHandler{constructor(e,t,l){this.loadZipData(),this.loadHills(),this.loadLifts(),this.handleDtSymbolClick(),this.handleIpSymbolClick(),this.handlePhSymbolClick(),this.handleLoSymbolClick(),this.handleShSymbolClick(),this.handleEqSymbolClick(),this.handleIdSymbolClick(),this.handleScSymbolClick(),this.handleJdSymbolClick(),this.handleFaSymbolClick(),this.handlePtSymbolClick(),this.handleTdSymbolClick(),this.handleWtSymbolClick(),this.handleRcSymbolClick(),this.calculateAge(e,l,t),this.handlePatientZip(),this.handleLocation(),this.handleLesson(),this.handleNumOther(),this.setEquipOther(),this.setDins(),this.handleRental(),this.handleHelmet(),this.handleVideo(),this.handlePatrollers("statementTaker",0),this.handlePatrollers("scenePatrollers",0),this.handlePatrollers("transportPatrollers",0),this.handlePatrollers("aidRoomPatrollers",0),this.handleWitnesses(0),this.handlePatrollers("reportCompleter",0),this.handleSubmit(),this.handleReset(),this.validateListen()}loadZipData(){this.performAjax("XHR0",0,e=>{this.zipData=JSON.parse(e)})}loadHills(){this.performAjax("XHR1",0,e=>{this.hills=JSON.parse(e)})}loadLifts(){this.performAjax("XHR2",0,e=>{this.lifts=JSON.parse(e)})}handleDtSymbolClick(){document.getElementById("incidentTime").addEventListener("change",()=>{this.doSymbolClicks("injuredPerson","ipSymbol",!0)}),document.getElementById("dtSymbol").addEventListener("click",()=>{this.doSymbolClicks("dateTime","dtSymbol",!1)})}handleIpSymbolClick(){document.getElementById("occupation").addEventListener("focus",()=>{this.doSymbolClicks("patientHistory","phSymbol",!0)}),document.getElementById("ipSymbol").addEventListener("click",()=>{this.doSymbolClicks("injuredPerson","ipSymbol",!1)})}handlePhSymbolClick(){document.getElementById("ticketType").addEventListener("focus",()=>{this.doSymbolClicks("location","loSymbol",!0)}),document.getElementById("phSymbol").addEventListener("click",()=>{this.doSymbolClicks("patientHistory","phSymbol",!1)})}handleLoSymbolClick(){document.getElementById("specificLocation").addEventListener("focus",()=>{this.doSymbolClicks("skiingHistory","shSymbol",!0)}),document.getElementById("loSymbol").addEventListener("click",()=>{this.doSymbolClicks("location","loSymbol",!1)})}handleShSymbolClick(){document.getElementById("equipRemoval").addEventListener("click",()=>{this.doSymbolClicks("equipment","eqSymbol",!0)}),document.getElementById("shSymbol").addEventListener("click",()=>{this.doSymbolClicks("skiingHistory","shSymbol",!1)})}handleEqSymbolClick(){document.getElementById("videoPhoto").addEventListener("click",()=>{this.doSymbolClicks("incidentDescription","idSymbol",!0)}),document.getElementById("eqSymbol").addEventListener("click",()=>{this.doSymbolClicks("equipment","eqSymbol",!1)})}handleIdSymbolClick(){document.getElementById("incidentDescriptionText").addEventListener("focus",()=>{this.doSymbolClicks("siteConditions","scSymbol",!0)}),document.getElementById("idSymbol").addEventListener("click",()=>{this.doSymbolClicks("incidentDescription","idSymbol",!1)})}handleScSymbolClick(){document.getElementById("surface").addEventListener("click",()=>{this.doSymbolClicks("injuryData","jdSymbol",!0)}),document.getElementById("scSymbol").addEventListener("click",()=>{this.doSymbolClicks("siteConditions","scSymbol",!1)})}handleJdSymbolClick(){document.getElementById("probableInjury").addEventListener("click",()=>{this.doSymbolClicks("firstAid","faSymbol",!0)}),document.getElementById("jdSymbol").addEventListener("click",()=>{this.doSymbolClicks("injuryData","jdSymbol",!1)})}handleFaSymbolClick(){document.getElementById("patrolRoomAid").addEventListener("click",()=>{this.doSymbolClicks("patrollers","ptSymbol",!0)}),document.getElementById("faSymbol").addEventListener("click",()=>{this.doSymbolClicks("firstAid","faSymbol",!1)})}handlePtSymbolClick(){document.getElementById("aidRoomPatrollers").addEventListener("click",()=>{this.doSymbolClicks("transport","tdSymbol",!0)}),document.getElementById("ptSymbol").addEventListener("click",()=>{this.doSymbolClicks("patrollers","ptSymbol",!1)})}handleTdSymbolClick(){document.getElementById("destination").addEventListener("click",()=>{this.doSymbolClicks("witnesses","wtSymbol",!0),this.doSymbolClicks("completer","rcSymbol",!0)}),document.getElementById("tdSymbol").addEventListener("click",()=>{this.doSymbolClicks("transport","tdSymbol",!1)})}handleWtSymbolClick(){document.getElementById("addWitness").addEventListener("click",()=>{this.doSymbolClicks("completer","rcSymbol",!0)}),document.getElementById("wtSymbol").addEventListener("click",()=>{this.doSymbolClicks("witnesses","wtSymbol",!1)})}handleRcSymbolClick(){document.getElementById("rcSymbol").addEventListener("click",()=>{this.doSymbolClicks("completer","rcSymbol",!1)})}doSymbolClicks(e,t,l){"block"!==document.getElementById(e).style.display||l?(document.getElementById(t).innerHTML='<i class="fas fa-minus expanderFont float-right"></i>',l&&"block"!==document.getElementById(e).style.display?FadeStuff.doAccordian("open",e):document.getElementById(e).style.display="block"):(document.getElementById(t).innerHTML='<i class="fas fa-plus expanderFont float-right"></i>',l?FadeStuff.doAccordian("close",e):document.getElementById(e).style.display="none")}calculateAge(e,t,l){document.getElementById("dob").addEventListener("blur",()=>{let i=document.getElementById("dob").value,n=new Date(i),d=e-n.getFullYear(),s=t-n.getMonth();(s<0||0===s&&l<n.getDate())&&d--,document.getElementById("age").value=d})}handlePatientZip(){document.getElementById("patientZip").addEventListener("blur",()=>{for(let e of this.zipData)if(document.getElementById("patientZip").value===e[0]){document.getElementById("patientCity").value=e[1],document.getElementById("patientState").value=e[2];break}})}handleLocation(){document.getElementById("lifts").style.visibility="hidden",document.getElementById("hills").style.visibility="hidden";let e=document.forms[0].elements.location;e[0].addEventListener("click",()=>{document.getElementById("lifts").style.visibility="visible",document.getElementById("hills").style.visibility="hidden",document.getElementById("whichLift").options.length=1,document.getElementById("whichHill").options.length=1;for(let e of this.lifts){let t=document.createElement("option");t.text=e,t.value=e,document.getElementById("whichLift").appendChild(t)}document.getElementById("whichLift").addEventListener("change",()=>{document.getElementById("hillLift").value=document.getElementById("whichLift").options[document.getElementById("whichLift").selectedIndex].text,document.getElementById("difficulty").value=null})}),e[1].addEventListener("click",()=>{document.getElementById("lifts").style.visibility="hidden",document.getElementById("hills").style.visibility="visible",document.getElementById("whichLift").options.length=1,document.getElementById("whichHill").options.length=1;for(let e of this.hills){let t=document.createElement("option");t.text=e[0],t.value=e[1],document.getElementById("whichHill").appendChild(t)}document.getElementById("whichHill").addEventListener("change",()=>{document.getElementById("hillLift").value=document.getElementById("whichHill").options[document.getElementById("whichHill").selectedIndex].text,document.getElementById("difficulty").value=document.getElementById("whichHill").options[document.getElementById("whichHill").selectedIndex].value})}),e[2].addEventListener("click",()=>{document.getElementById("lifts").style.visibility="hidden",document.getElementById("hills").style.visibility="hidden"})}handleLesson(){document.getElementById("instYes").style.visibility="hidden";let e=document.forms[0].elements.inLesson;e[0].addEventListener("change",()=>{alert("Remember: You must fill out an instructor witness statement form."),document.getElementById("instYes").style.visibility="visible"}),e[1].addEventListener("change",()=>{document.getElementById("instructor").value=null,document.getElementById("instYes").style.visibility="hidden"})}handleNumOther(){document.getElementById("otherNum").style.visibility="hidden";let e=document.forms[0].elements.numTimes;e[2].addEventListener("change",()=>{document.getElementById("otherNum").style.visibility="visible"});for(let t=0;t<2;t++)e[t].addEventListener("change",()=>{document.getElementById("otherNum").style.visibility="hidden"})}setEquipOther(){document.getElementById("otherEquipYes").style.visibility="hidden";let e=document.forms[0].elements.equipmentType;e[3].addEventListener("click",()=>{document.getElementById("otherEquipYes").style.visibility="visible"}),e[3].addEventListener("click",()=>{document.getElementById("otherEquipYes").style.visibility="visible"});for(let t=0;t<3;t++)e[t].addEventListener("change",()=>{document.getElementById("otherEquipYes").style.visibility="hidden"})}setDins(){document.getElementById("leftToeDin").style.visibility="hidden",document.getElementById("leftHeelDin").style.visibility="hidden",document.getElementById("rightToeDin").style.visibility="hidden",document.getElementById("rightHeelDin").style.visibility="hidden",document.getElementById("equipAlpine").addEventListener("click",()=>{document.getElementById("leftToeDin").style.visibility="visible",document.getElementById("leftHeelDin").style.visibility="visible",document.getElementById("rightToeDin").style.visibility="visible",document.getElementById("rightHeelDin").style.visibility="visible"}),document.getElementById("equipNordic").addEventListener("click",()=>{document.getElementById("leftToeDin").style.visibility="hidden",document.getElementById("leftHeelDin").style.visibility="hidden",document.getElementById("rightToeDin").style.visibility="hidden",document.getElementById("rightHeelDin").style.visibility="hidden"}),document.getElementById("equipSnowboard").addEventListener("click",()=>{document.getElementById("leftToeDin").style.visibility="hidden",document.getElementById("leftHeelDin").style.visibility="hidden",document.getElementById("rightToeDin").style.visibility="hidden",document.getElementById("rightHeelDin").style.visibility="hidden"}),document.getElementById("equipOther").addEventListener("click",()=>{document.getElementById("leftToeDin").style.visibility="hidden",document.getElementById("leftHeelDin").style.visibility="hidden",document.getElementById("rightToeDin").style.visibility="hidden",document.getElementById("rightHeelDin").style.visibility="hidden"})}handleRental(){document.getElementById("rentalEquip").style.visibility="hidden",document.getElementById("rentalEquipNums").style.visibility="hidden";let e=document.forms[0].elements.owner;e[0].addEventListener("click",()=>{document.getElementById("rentalEquip").style.visibility="hidden",document.getElementById("rentalEquipNums").style.visibility="hidden"}),e[1].addEventListener("click",()=>{document.getElementById("rentalEquip").style.visibility="hidden",document.getElementById("rentalEquipNums").style.visibility="visible"}),e[2].addEventListener("click",()=>{document.getElementById("rentalEquip").style.visibility="hidden",document.getElementById("rentalEquipNums").style.visibility="hidden"}),e[3].addEventListener("click",()=>{document.getElementById("rentalEquip").style.visibility="hidden",document.getElementById("rentalEquipNums").style.visibility="visible"}),e[4].addEventListener("click",()=>{document.getElementById("rentalEquip").style.visibility="visible",document.getElementById("rentalEquipNums").style.visibility="visible",document.getElementById("shopZip").addEventListener("blur",()=>{for(let e of this.zipData)if(document.getElementById("shopZip").value===e[0]){document.getElementById("shopCity").value=e[1],document.getElementById("shopState").value=e[2];break}})})}handleHelmet(){let e=document.forms[0].elements.helmet,t=document.forms[0].elements.helmetRental;document.getElementById("helmetYes").style.visibility="hidden",document.getElementById("helmetRentalYep").style.visibility="hidden",e[0].addEventListener("click",()=>{document.getElementById("helmetYes").style.visibility="hidden",document.getElementById("helmetRentalYep").style.visibility="hidden"}),e[1].addEventListener("click",()=>{document.getElementById("helmetYes").style.visibility="visible",t[0].addEventListener("click",()=>{document.getElementById("helmetRentalYep").style.visibility="hidden"}),t[1].addEventListener("click",()=>{document.getElementById("helmetRentalYep").style.visibility="visible"})})}handleVideo(){let e=document.forms[0].elements.video;document.getElementById("videoYes").style.visibility="hidden",e[0].addEventListener("click",()=>{document.getElementById("videoYes").style.visibility="hidden"}),e[1].addEventListener("click",()=>{document.getElementById("videoYes").style.visibility="visible"})}handlePatrollers(e,t){let l=document.createElement("select");l.name=`${e}_${t}`,l.id=`${e}_${t}`,l.size=1;let i=document.createElement("option");if(i.text="CHOOSE PATROLLER",i.value="",i.selected=!0,document.getElementById(`${e}`).appendChild(l),document.getElementById(`${e}_${t}`).appendChild(i),this.performAjax("XHR3",0,l=>{this.patrollers=JSON.parse(l),document.getElementById(`${e}_${t}`).options.length=1;for(let l of this.patrollers){let i=document.createElement("option");l=l[1]+" "+l[0],i.text=l,i.value=l,document.getElementById(`${e}_${t}`).appendChild(i)}}),"reportCompleter"!==e&&"statementTaker"!==e){let l;document.getElementById(`${e}_${t}`).addEventListener("change",l=()=>(document.getElementById(`${e}Count`).value=t,document.getElementById(`${e}_${t}`).removeEventListener("change",l),t++,this.handlePatrollers(e,t)))}}handleWitnesses(e){let t=e+1,l=document.createElement("div");l.className="grid-x grid-padding-x",l.id=`w${e}`;let i,n=`\n                    <div class="small-2 cell">\n                        <span class="label expand-label">Witness ${t} - Last Name</span>\n                        <input name="w${e}LastName" id="w${e}LastName" type="text" placeholder="Last Name">\n                    </div>\n                    <div class="small-2 cell">\n                        <span class="label expand-label">First Name</span>\n                        <input name="w${e}FirstName" id="w${e}FirstName" type="text" placeholder="First Name">\n                    </div>\n                    <div class="small-2 cell">\n                        <span class="label expand-label">Home Phone</span>\n                        <input name="w${e}HomePhoneNum" id="w${e}HomePhoneNum" type="tel" placeholder="Phone number">\n                    </div>\n                    <div class="small-2 cell">\n                        <span class="label expand-label">Cell Phone</span>\n                        <input name="w${e}CellPhoneNum" id="w${e}CellPhoneNum" type="tel" placeholder="Cell number">\n                    </div>\n                    <div class="small-3 cell">\n                        <span class="label expand-label">Street</span>\n                        <input name="w${e}Street" id="w${e}Street" type="text" placeholder="Street number">\n                    </div>\n                    <div class="small-1 cell">\n                        <span class="label expand-label warning"><i class="fas fa-exclamation-triangle"></i> Zip</span><br>\n                        <input name="w${e}Zip" id="w${e}Zip" type="text" placeholder="Zip" required>\n                    </div>\n                    <input name="w${e}City" id="w${e}City" type="none" hidden>\n                    <input name="w${e}" id="w${e}State" type="none" hidden>\n        `;document.getElementById("addWitness").addEventListener("click",i=()=>{let t;document.getElementById("addWitness").removeEventListener("click",i),document.getElementById("addWitness").disabled=!0,document.getElementById("addWitness").classList.add("disabled"),document.getElementById("addWitness").removeEventListener("click",i),document.getElementById("witnesses").appendChild(l),document.getElementById(l.id).innerHTML+=n,document.getElementById(`w${e}Zip`).addEventListener("change",t=()=>{if(document.getElementById(`w${e}Zip`).value)for(let l of this.zipData)if(document.getElementById(`w${e}Zip`).value===l[0])return document.getElementById(`w${e}City`).value=l[1],document.getElementById(`w${e}State`).value=l[2],document.getElementById(`w${e}Zip`).removeEventListener("change",t),document.getElementById("addWitness").disabled=!1,document.getElementById("addWitness").classList.remove("disabled"),e++,this.handleWitnesses(e)})})}handleSubmit(){document.getElementById("submit").addEventListener("click",()=>(document.getElementById("mainForm").checkValidity()?(console.log("submit button pressed."),new SetSessionStorage,window.open("/public/views/results.html","_blank","location=yes,height=900,width=1000,scrollbars=yes,status=yes"),(document.getElementById("equipAlpine").checked&&document.getElementById("ownerRent").checked||document.getElementById("ownerDemo").checked)&&window.open("/public/views/skiRental.html","_blank","location=yes,height=900,width=950,scrollbars=yes,status=yes"),document.getElementById("helmetRentalYes").checked&&window.open("/public/views/helmetRental.html","_blank","location=yes,height=900,width=900,scrollbars=yes,status=yes")):console.log("Submit form is broken!"),!1))}handleReset(){document.getElementById("reset").addEventListener("click",()=>{window.location.reload()})}performAjax(e,t,l){let i="?"+(new Date).getTime();const n=new XMLHttpRequest;n.open("POST",document.url+i,!0),n.setRequestHeader("X-Requested-with",e),n.send(t),n.onload=()=>{if(4===n.readyState&&200===n.status&&l)return l(n.responseText)}}validateListen(){document.addEventListener("click",()=>{this.validateForm()})}validateForm(){let e=document.getElementById("mainForm"),t=!0;for(let l=0;l<e.elements.length;l++)e.elements[l].hasAttribute("required")&&""===e.elements[l].value&&(t=!1);t?document.getElementById("submit").disabled=!1:console.log("NOT valid yet!")}}